---
title: "Homework Assignment #2"
subtitle: "Exploring patterns of environmental justice"
author: "Liz Peterson"
date: last-modified
execute: 
  eval: false
format:
  html:
    toc: true
editor_options: 
  chunk_output_type: console
---

## Part 1: Legacy of redlining in current environmental (in)justice

```{r}
# Load libraries

library(here)
library(tidyverse)
library(ggplot2)
library(sf)
library(tmap)
```

```{r}
# Read in data
ej_df <- st_read(here('data','ejscreen','EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb'))
holc_df <- st_read(here('data','mapping-inequality','mapping-inequality-los-angeles.json'))
birds_df <- st_read(here('data','gbif-birds-LA','gbif-birds-LA.shp'))
```

```{r}
# Subset the ej_df to just include Los Angeles County
la_ej_df <- ej_df %>%
  filter(CNTY_NAME=='Los Angeles County' & ID != "060379903000" & ID != "060379902000") # The ID filtering part takes out the buffer around the ocean
```

```{r}
# Initial map of LA County EJ with HOLC grades layered on top
tm_shape(la_ej_df, bbox = holc_df) +
  tm_borders() +
tm_shape(holc_df) +
  tm_polygons('grade',
              palette = c('A' = 'lightgreen',
                          'B' = 'lightblue',
                          'C' = '#FFEF00',
                          'D' = '#F94449'),
              title = "HOLC Grade") +
  tm_layout(main.title = "Redlining in Los Angeles County",
            main.title.position = "center") +
  tm_scale_bar(position = c("right","top"),
               text.size = 0.5) +
  tm_compass(position = c("left","bottom"),
             size = 1)
```

```{r}
# Summarize the percent of current census block groups within each HOLC grade

# Check that la_ej_df and holc_df have the same CRS
# print(st_crs(holc_df) == st_crs(la_ej_df)) 

# Transform the CRS to be the same
holc_df_transform <- st_transform(holc_df, crs = st_crs(la_ej_df))
# Build in check to make sure that the transformation worked
if(st_crs(holc_df_transform) == st_crs(la_ej_df)){
  print("it's a match!")
} else {
  warning("coordinate reference systems do not match")
}

# Join data frames
combined_df <- st_join(holc_df_transform, la_ej_df, join = st_intersects)
```

```{r}
# Use combined_df to make summary table
census_groups <- combined_df %>%
  group_by(grade) %>%
  summarize(census_block_pct = n()/nrow(la_ej_df)*100) %>%
  select(grade, census_block_pct) %>%
  st_drop_geometry()

print(census_groups)
```

```{r}
# Creating a set of figures summarizing current conditions within HOLC grades
current_conditions <- combined_df %>%
  group_by(grade) %>%
  summarize(pct_low_income = mean(LOWINCPCT, na.rm=TRUE),
            pct_part_matter = mean(PM25, na.rm=TRUE),
            pct_life_exp = mean(LIFEEXPPCT, na.rm=TRUE)) %>%
  st_drop_geometry()

print(current_conditions)
```

```{r}
ggplot(current_conditions) +
  geom_col(aes('pct_low_income', 'pct_part_matter','pct_life_exp'))
```

The results of this summary table tell us that as we move from grade A to D, all three of these variables steadily rises. This means that the percentage of low income folk, the percentile for PM 2.5, and the percentile for low life expectancy all increase as we go to lower grades. The percentage of low income people increases the most dramatically out of these variables.

## Part 2: Legacy of redlining in biodiversity observations

```{r}

```

